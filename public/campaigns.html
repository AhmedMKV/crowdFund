<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
     <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://kit.fontawesome.com/4913f458b1.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="./CSS/style.css">
    <style>
        .campaigns-wrapper {
            display: flex;
            gap: 2rem;
            margin-top: 2rem;
        }
        
        .side-nav {
            width: 250px;
            flex-shrink: 0;
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 8px;
            height: fit-content;
        }
        
        .side-nav h3 {
            font-size: 1.2rem;
            margin-bottom: 1rem;
            color: #333;
        }
        
        .side-nav .nav-link {
            color: #666;
            padding: 0.5rem 0;
            display: block;
            text-decoration: none;
            transition: color 0.2s;
        }
        
        .side-nav .nav-link:hover,
        .side-nav .nav-link.active {
            color: #0d6efd;
        }
        
        .side-nav .nav-link i {
            margin-right: 0.5rem;
            width: 20px;
            text-align: center;
        }
        
        .campaigns-content {
            flex-grow: 1;
        }
        
        @media (max-width: 768px) {
            .campaigns-wrapper {
                flex-direction: column;
            }
            
            .side-nav {
                width: 100%;
                margin-bottom: 1rem;
            }
        }
        
        .campaign-card {
            display: none;
        }
        
        .campaign-card.active {
            display: block;
        }
        
        .no-campaigns {
            display: none;
            text-align: center;
            padding: 2rem;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .no-campaigns.active {
            display: block;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container">
            <a class="navbar-brand" href="index.html">CrowdfundIt</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                <li class="nav-item"><a class="nav-link" href="index.html">Home</a></li>
                    <li class="nav-item"><a class="nav-link active" href="campaigns.html">Campaigns</a></li>
                    <li class="nav-item"><a class="nav-link" href="create.html">Start Campaign</a></li>
                    <li class="nav-item"><a class="nav-link" href="login.html">Login</a></li>
                </ul>
                <button class="btn btn-primary" type="button">Start a Campaign</button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="container py-4">
        <div class="campaigns-wrapper">
            <!-- Side Navigation -->
            <aside class="side-nav">
                <h3>Categories</h3>
                <nav>
                    <a href="#" class="nav-link" data-category="health">
                        <i class="fas fa-heartbeat"></i> Health & Wellness
                    </a>
                    <a href="#" class="nav-link" data-category="infrastructure">
                        <i class="fas fa-building"></i> Infrastructure
                    </a>
                    <a href="#" class="nav-link" data-category="technology">
                        <i class="fas fa-laptop"></i> Technology
                    </a>
                    <a href="#" class="nav-link" data-category="education">
                        <i class="fas fa-graduation-cap"></i> Education
                    </a>
                    <a href="#" class="nav-link" data-category="environment">
                        <i class="fas fa-leaf"></i> Environment
                    </a>
                    <a href="#" class="nav-link" data-category="arts">
                        <i class="fas fa-paint-brush"></i> Arts & Culture
                    </a>
                </nav>
            </aside>

            <!-- Campaigns Content -->
            <div class="campaigns-content">
                <h1 class="category-title mb-4">All Campaigns</h1>
                
                <div class="no-campaigns">
                    <i class="fas fa-search fa-3x mb-3 text-muted"></i>
                    <h3>No campaigns found</h3>
                    <p class="text-muted">There are no campaigns in this category yet.</p>
                        </div>
                        
                <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
                    <!-- Campaigns will be dynamically inserted here -->
                    </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="py-5 bg-dark text-white">
        <div class="container">
            <div class="row">
                <div class="col-md-3 mb-3">
                    <h5 class="footer-heading h6">Quick Links</h5>
                    <ul class="nav flex-column">
                        <li class="nav-item mb-2"><a href="#" class="nav-link p-0 footer-link">About</a></li>
                        <li class="nav-item mb-2"><a href="#" class="nav-link p-0 footer-link">Blog</a></li>
                        <li class="nav-item mb-2"><a href="#" class="nav-link p-0 footer-link">Contact</a></li>
                        <li class="nav-item mb-2"><a href="#" class="nav-link p-0 footer-link">FAQ</a></li>
                    </ul>
                </div>

                <div class="col-md-3 mb-3">
                    <h5 class="footer-heading h6">Follow Us</h5>
                    <ul class="nav">
                        <li class="nav-item me-3"><a href="#" class="text-white social-icon"><i class="fab fa-facebook-f"></i></a></li>
                        <li class="nav-item me-3"><a href="#" class="text-white social-icon"><i class="fab fa-twitter"></i></a></li>
                        <li class="nav-item me-3"><a href="#" class="text-white social-icon"><i class="fab fa-instagram"></i></a></li>
                        <li class="nav-item"><a href="#" class="text-white social-icon"><i class="fab fa-linkedin-in"></i></a></li>
                    </ul>
                </div>

                <div class="col-md-6 mb-3">
                    <h5 class="footer-heading h6">Newsletter</h5>
                    <p class="small">Get the latest updates on campaigns and success stories.</p>
                    <form>
                        <div class="input-group">
                            <input type="email" class="form-control form-control-sm" placeholder="Enter your email">
                            <button class="btn btn-primary btn-sm" type="button">Subscribe</button>
                        </div>
                    </form>
                </div>
            </div>
            <hr class="my-4">
            <p class="text-center mb-0 small">&copy; 2025 CrowdfundIt. All Rights Reserved.</p>
        </div>
    </footer>

    <!-- Bootstrap JS Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Get URL parameters
            const urlParams = new URLSearchParams(window.location.search);
            const categoryFromUrl = urlParams.get('category');
            
            // Get all category links and campaign cards
            const categoryLinks = Array.from(document.querySelectorAll('.side-nav .nav-link'));
            const campaignsContainer = document.querySelector('.row');
            const categoryTitle = document.querySelector('.category-title');
            const noCampaigns = document.querySelector('.no-campaigns');
            
            // Function to format currency
            function formatCurrency(amount) {
                return new Intl.NumberFormat('en-US', {
                    style: 'currency',
                    currency: 'USD',
                    maximumFractionDigits: 0
                }).format(amount);
            }
            
            // Function to create campaign card HTML
            function createCampaignCard(campaign) {
                return `
                    <div class="col">
                        <article class="campaign-card">
                            <figure class="campaign-image-wrapper mb-0 ratio ratio-16x9">
                                <img src="${campaign.image}" class="img-fluid object-fit-cover" alt="${campaign.title}">
                            </figure>
                            <div class="campaign-body p-3">
                                <h2 class="campaign-title h5">${campaign.title}</h2>
                                <p class="campaign-creator small text-muted">By ${campaign.creator}</p>
                                <p class="campaign-description">${campaign.description}</p>
                                
                                <div class="campaign-progress mb-2">
                                    <div class="progress-text d-flex justify-content-between small">
                                        <span>${campaign.progress}% funded</span>
                                        <span class="progress-percent fw-bold">${formatCurrency(campaign.raised)} raised</span>
                                    </div>
                                    <div class="progress" style="height: 8px">
                                        <div class="progress-bar" style="width: ${campaign.progress}%"></div>
                                    </div>
                                </div>
                                
                                <div class="campaign-stats d-flex justify-content-between small border-top pt-2 mt-2">
                                    <div class="stat-item text-center">
                                        <span class="stat-value d-block fw-bold">${campaign.backers}</span>
                                        <span class="stat-label text-muted">Backers</span>
                                    </div>
                                    <div class="stat-item text-center">
                                        <span class="stat-value d-block fw-bold">${campaign.daysLeft}</span>
                                        <span class="stat-label text-muted">Days Left</span>
                                    </div>
                                </div>
                                
                                <a href="campaign.html?id=${campaign.id}" class="btn btn-primary w-100 mt-3">
                                    <i class="fas fa-hand-holding-heart me-2"></i>Back This Project
                                </a>
                            </div>
                        </article>
                    </div>
                `;
            }
            
            // Function to filter and display campaigns
            function filterCampaigns(category) {
                console.log('Filtering campaigns for category:', category);
                
                // Update category title
                const categoryName = categoryLinks.find(link => link.dataset.category === category)?.textContent.trim();
                categoryTitle.textContent = categoryName ? `${categoryName} Projects` : 'All Campaigns';
                
                // Fetch campaigns from db.json
                fetch('http://localhost:3000/campaigns', {
                    headers: {
                        'Accept': 'application/json'
                    }
                })
                    .then(response => {
                        console.log('Response status:', response.status);
                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                        return response.json();
                    })
                    .then(campaigns => {
                        console.log('Fetched campaigns:', campaigns);
                        
                        // Filter campaigns based on category
                        const filteredCampaigns = category === 'all' 
                            ? campaigns 
                            : campaigns.filter(campaign => campaign.category === category);
                        
                        console.log('Filtered campaigns:', filteredCampaigns);
                        
                        // Clear existing campaigns
                        campaignsContainer.innerHTML = '';
                        
                        // Show/hide no campaigns message
                        if (filteredCampaigns.length === 0) {
                            noCampaigns.classList.add('active');
                        } else {
                            noCampaigns.classList.remove('active');
                            // Add filtered campaigns to the container
                            filteredCampaigns.forEach(campaign => {
                                campaignsContainer.innerHTML += createCampaignCard(campaign);
                            });
                        }
                        
                        // Update active state of category links
                        categoryLinks.forEach(link => {
                            link.classList.toggle('active', link.dataset.category === category);
                        });
                    })
                    .catch(error => {
                        console.error('Error fetching campaigns:', error);
                        noCampaigns.classList.add('active');
                        noCampaigns.innerHTML = `
                            <i class="fas fa-exclamation-circle fa-3x mb-3 text-danger"></i>
                            <h3>Error Loading Campaigns</h3>
                            <p class="text-muted">Please try again later.</p>
                            <p class="text-danger small">${error.message}</p>
                        `;
                    });
            }
            
            // Add click event listeners to category links
            categoryLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const category = this.dataset.category;
                    console.log('Category clicked:', category);
                    filterCampaigns(category);
                    
                    // Update URL without page reload
                    const newUrl = new URL(window.location);
                    newUrl.searchParams.set('category', category);
                    window.history.pushState({}, '', newUrl);
                });
            });
            
            // Filter campaigns based on URL parameter if present
            if (categoryFromUrl) {
                console.log('Category from URL:', categoryFromUrl);
                filterCampaigns(categoryFromUrl);
            } else {
                console.log('No category in URL, showing all campaigns');
                filterCampaigns('all');
            }
        });
    </script>
</body>
</html>